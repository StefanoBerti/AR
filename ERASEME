FROM nvcr.io/nvidia/tensorrt:20.01-py3
WORKDIR /home

# Install dependencies
RUN apt update
RUN apt install ffmpeg libsm6 libxext6 -y  # For opencv

# Install conda
RUN wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
RUN chmod +x Miniconda3-latest-Linux-x86_64.sh
RUN ./Miniconda3-latest-Linux-x86_64.sh -b -p /home/miniconda

# Create and activate environment
COPY environment.yml .
RUN ./miniconda/bin/conda env create -f environment.yml
SHELL ["./miniconda/bin/conda", "run", "-n", "myenv", "/bin/bash", "-c"]

# Make sure to be inside environment
RUN echo "Make sure cv2 is installed:"
RUN python -c "import cv2"

# The code to run when container is started:
RUN pip install ptgaze
COPY . .
ENTRYPOINT ["./miniconda/bin/conda", "run", "--no-capture-output", "-n", "myenv", "python", "main.py"]

# Copy files
#ENV PYTHONPATH="${PYTHONPATH}:/home"
